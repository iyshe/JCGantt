var JCGantt=function(){"use strict";var Ue=Object.defineProperty;var se=Object.getOwnPropertySymbols;var Qe=Object.prototype.hasOwnProperty,Ze=Object.prototype.propertyIsEnumerable;var re=(_,b,w)=>b in _?Ue(_,b,{enumerable:!0,configurable:!0,writable:!0,value:w}):_[b]=w,d=(_,b)=>{for(var w in b||(b={}))Qe.call(b,w)&&re(_,w,b[w]);if(se)for(var w of se(b))Ze.call(b,w)&&re(_,w,b[w]);return _};var oe=(_,b,w)=>new Promise((ot,N)=>{var K=m=>{try{Y(w.next(m))}catch(I){N(I)}},E=m=>{try{Y(w.throw(m))}catch(I){N(I)}},Y=m=>m.done?ot(m.value):Promise.resolve(m.value).then(K,E);Y((w=w.apply(_,b)).next())});var _=I(["Function","RegExp","Date","Error","CanvasGradient","CanvasPattern","Image","Canvas"],function(n,t){return n["[object "+t+"]"]=!0,n},{}),b=I(["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64"],function(n,t){return n["[object "+t+"Array]"]=!0,n},{}),w=Object.prototype.toString,ot=Array.prototype,N=ot.slice,K=function(){}.constructor,E=K?K.prototype:null,Y="__proto__";function m(n){if(n==null||typeof n!="object")return n;var t=n,e=w.call(n);if(e==="[object Array]"){if(!at(n)){t=[];for(var i=0,s=n.length;i<s;i++)t[i]=m(n[i])}}else if(b[e]){if(!at(n)){var r=n.constructor;if(r.from)t=r.from(n);else{t=new r(n.length);for(var i=0,s=n.length;i<s;i++)t[i]=n[i]}}}else if(!_[e]&&!at(n)&&!we(n)){t={};for(var o in n)n.hasOwnProperty(o)&&o!==Y&&(t[o]=m(n[o]))}return t}function I(n,t,e,i){if(n&&t){for(var s=0,r=n.length;s<r;s++)e=t.call(i,e,n[s],s,n);return e}}function fe(n,t){for(var e=[],i=2;i<arguments.length;i++)e[i-2]=arguments[i];return function(){return n.apply(t,e.concat(N.call(arguments)))}}E&&k(E.bind)&&E.call.bind(E.bind);function me(n){return Array.isArray?Array.isArray(n):w.call(n)==="[object Array]"}function k(n){return typeof n=="function"}function L(n){return typeof n=="string"}function ye(n){var t=typeof n;return t==="function"||!!n&&t==="object"}function we(n){return typeof n=="object"&&typeof n.nodeType=="number"&&typeof n.ownerDocument=="object"}var ve="__ec_primitive__";function at(n){return n[ve]}class G{constructor(t,e){this.originOption=m(t),this.fullOption=e}}moment.suppressDeprecationWarnings=!0,moment.locale("zh-cn",{week:{dow:1}});const ht={cellWidth:75,cellHeight:35},u=moment,It={info:"#909399",error:"#F56C6C",warn:"#E6A23C",success:"#67C23A",冰川蓝:"#84A3BC",蜜橙:"#FFBE90",珊瑚粉:"#E2A9A1"},lt=class _t{constructor(t){if(this.start=new Date,this.days=_t.defaultDays,this.accuracy="second",this.baseWidth=ht.cellWidth,this.scales=[new Lt],t){let e=[];t.scales&&t.scales.forEach(i=>{e.push(new Lt(i))});for(let i in t)this[i]=t[i];e.length>0&&(this.scales=e)}}getAccuracy(){return _t.accuracyMap.get(this.accuracy)}};lt.defaultDays=-60,lt.accuracyMap=new Map().set("second",1).set("minute",60).set("hour",3600).set("day",86400).set("week",604800).set("month",18144e3).set("year",662256e4);let ct=lt;class Lt{constructor(t){if(this.symbol="day",this.formatter="YY/MM/DD",t)for(let e in t)this[e]=t[e]}}function Pt(n,t,e){if(L(n))return u(t).format(n);if(k(n))return n(t,e)}const Bt=class ae extends G{constructor(t){super(t,new ct(t)),this.type=ae.type,this.timeBase=1,this._timeBase=1,this.option=m(t)}refresh(){this.init()}init(){const{start:t,end:e}=this.getStartAndEnd();this.start=t,this.end=e,this.initMetaDataMap(t,e),this.initMetaDataList()}initMetaDataMap(t,e){let i=this;this.metaDataMap=new Map;let s=this.fullOption.scales,r=this.getMinAccuracyScale(s);this.originMinUnit=r?r.symbol:"day";let o=this.unitConversion(this._timeBase,this._timeUnit||this.originMinUnit);this.timeBase=Math.floor(o.timeBase),this.minUnit=o.timeUnit;let a=o.formatter;s.forEach(h=>{i.metaDataMap.get(h.symbol)||(h.symbol==i.originMinUnit?i.metaDataMap.set(h.symbol,i.createMinTimeMetaData(h,this.timeBase,i.minUnit,a,t,e)):i.metaDataMap.set(h.symbol,i.createTimeMetaData(h,this.timeBase,i.minUnit,t,e)))})}initMetaDataList(){let t=this;this.metaDataList=[],this.fullOption.scales.forEach(e=>{t.metaDataList.push(t.metaDataMap.get(e.symbol))})}getMinAccuracyScale(t){return t&&t.length>0?t.reduce((e,i)=>ct.accuracyMap.get(e.symbol)-ct.accuracyMap.get(i.symbol)<=0?e:i):null}getStartAndEnd(){let t=this.fullOption.start,e=this.fullOption.end,i=this.fullOption.days;return e?(e=u(e).toDate(),i>0?t=u(e).subtract(Math.abs(i),"d").toDate():t=u(t).toDate()):(t=u(t).toDate(),e=u(t).add(Math.abs(i),"d").toDate()),t=u(t).startOf("d").toDate(),e=u(e).startOf("d").toDate(),{start:t,end:e}}createMinTimeMetaData(t,e,i,s,r,o){let a=[];!s&&t.symbol!=i&&(s=C.defaultFormatter[i]);let h=u(r),l=u(o),c=u(r),f=null,g=null,v=t.commonStyle||{};for(;c.isBetween(h,l,"second","[)");){g=c.clone(),f=u.min([c.add(e,i).startOf(i),l]);let z={symbol:i,start:g.toDate(),end:f.toDate(),counts:f.diff(g,i)/e||1,baseWidth:this.fullOption.baseWidth,text:Pt(s||t.formatter,g.toDate(),f.toDate())};z.style=d(d({},v),k(t.style)?t.style(z):{}),this.initStyleProperties(z,i),a.push(z)}return a}createTimeMetaData(t,e,i,s,r){let o=[],a=u(s),h=u(r),l=u(s),c=null,f=null,g=t.commonStyle||{};for(;l.isBetween(a,h,"second","[)");){f=l.clone(),c=u.min([l.add(1,t.symbol).startOf(t.symbol),h]);let v={symbol:t.symbol,start:f.toDate(),end:c.toDate(),counts:c.diff(f,i)/e||1,baseWidth:this.fullOption.baseWidth,text:Pt(t.formatter,f.toDate(),c.toDate())};v.style=d(d({},g),k(t.style)?t.style(v):{}),o.push(v)}return o}initStyleProperties(t,e){if(!this.styleProperties&&t.symbol==e){let i=0;me(t.style.padding)?t.style.padding.length>2?i=t.style.padding[1]+t.style.padding[3]:i=t.style.padding[1]:i=t.style.padding||0,this.styleProperties={border:(t.style.borderWidth||.5)*2,padding:i}}}unitConversion(t,e,i){switch(e){case"year":{if(t<1)t=12*t,e="month",i="YY年MM月";else return{timeBase:t,timeUnit:e,formatter:i};return this.unitConversion(t,e,i)}case"month":{if(t>=12)t=Math.floor(t/12),e="year",i="YY年";else if(t<1)t=t*30,e="day",i="MM月DD日";else return{timeBase:t,timeUnit:e,formatter:i};return this.unitConversion(t,e,i)}case"day":{if(t>=30)t=Math.floor(t/30),e="month",i="MM月";else if(t<1)t=24*t,e="hour",i="DD日HH时";else return{timeBase:t,timeUnit:e,formatter:i};return this.unitConversion(t,e,i)}case"hour":{if(t>=24)t=Math.floor(t/24),e="day",i="DD日";else if(t<1)t=60*t,e="minute",i="HH时mm分";else return{timeBase:t,timeUnit:e,formatter:i};return this.unitConversion(t,e,i)}case"minute":{if(t>=60)t=Math.floor(t/60),e="hour",i="HH时";else if(t<1)t=t*60,e="second",i="mm分ss秒";else return{timeBase:t,timeUnit:e,formatter:i};return this.unitConversion(t,e,i)}case"second":{if(t>=60)t=Math.floor(t/60),e="minute",i="mm分";else if(t<1)t=1;else return{timeUnit:e,timeBase:t,formatter:i};return this.unitConversion(t,e,i)}}}};Bt.type="timeScale";let ke=Bt;const At=class he{constructor(t){this.type=he.type,this.source=t}};At.type="resize";let J=At;class dt extends zrender.Group{constructor(){super(...arguments),this.eventType=J.type}add(t){let e=super.add(t);return this.realWidth=super.getBoundingRect().width,this.realHeight=super.getBoundingRect().height,e}addHorizon(t){return this.add(t)}addVertical(t){return this.add(t)}addContent(t){return this.add(t)}setComponent(t){this.component=t}resize(t,e){}handleEvent(t){this.resize(),this.component&&this.component.refresh()}}const Ht=class le extends dt{constructor(){super(...arguments),this.type=le.type}addHorizon(t){t.hv="horizon";let e=this.getBoundingRect().width;return t&&t.setPosition([e,0]),this.add(t)}addVertical(t){t.hv="verity";let e=this.getBoundingRect().height;return t&&t.setPosition([0,e]),this.add(t)}getLastChild(t){let e;return this.eachChild(i=>{i instanceof dt&&i.hv===t&&(e=i)}),e}refresh(){}};Ht.type="StackContainer";let P=Ht;const ut=class Mt{constructor(){this.animateMap=new Map}static getInstance(){return Mt.instance}addAnimate(t,e,i){let s=null;return(s=this.animateMap.get(t))||(s=new Map,this.animateMap.set(t,s)),s.set(e,i),i}getAnimate(t,e){let i=null,s=this.animateMap.get(t);if(s&&(i=s.get(e)),i){i._started=0;for(let r in i._tracks)i._tracks[r]._finished=!1}return i}createAnimate(t,e,i,s,r,o,a){let h=t[e],l=d(d({},h),i),c=t.animate(e,o,!0).when(s,l).done(()=>{r&&(t[e]=l)});return Mt.getInstance().addAnimate(t,a,c),c}};ut.instance=new ut;let U=ut;function Yt(n,t,e){n.originStyle||(n.originStyle=n[t]),n.onmouseover=i=>{if(i.event.preventDefault(),n.hoverForbid)return;let s=d(d({},n.originStyle),e);n.dirty(),n[t]=s},n.onmouseout=i=>{i.event.preventDefault(),!n.hoverForbid&&(n.dirty(),n[t]=n.originStyle)},n.restoreStyle=()=>{let i=n.originStyle;n.dirty(),n[t]=i}}function D(n,t,e){if(!(!n||!t))for(let i in n)t[i]?k(n[i])?e&&(t[i]=n[i]):ye(n[i])?D(n[i],t[i],e):e&&(t[i]=n[i]):t[i]=n[i]}var Gt=function(){function n(t){this.value=t}return n}(),be=function(){function n(){this._len=0}return n.prototype.insert=function(t){var e=new Gt(t);return this.insertEntry(e),e},n.prototype.insertEntry=function(t){this.head?(this.tail.next=t,t.prev=this.tail,t.next=null,this.tail=t):this.head=this.tail=t,this._len++},n.prototype.remove=function(t){var e=t.prev,i=t.next;e?e.next=i:this.head=i,i?i.prev=e:this.tail=e,t.next=t.prev=null,this._len--},n.prototype.len=function(){return this._len},n.prototype.clear=function(){this.head=this.tail=null,this._len=0},n}(),Se=function(){function n(t){this._list=new be,this._maxSize=10,this._map={},this._maxSize=t}return n.prototype.put=function(t,e){var i=this._list,s=this._map,r=null;if(s[t]==null){var o=i.len(),a=this._lastRemovedEntry;if(o>=this._maxSize&&o>0){var h=i.head;i.remove(h),delete s[h.key],r=h.value,this._lastRemovedEntry=h}a?a.value=e:a=new Gt(e),a.key=t,i.insertEntry(a),s[t]=a}return r},n.prototype.get=function(t){var e=this._map[t],i=this._list;if(e!=null)return e!==i.tail&&(i.remove(e),i.insertEntry(e)),e.value},n.prototype.clear=function(){this._list.clear(),this._map={}},n.prototype.len=function(){return this._list.len()},n}();const Te=Se;var Xt={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function X(n){return n=Math.round(n),n<0?0:n>255?255:n}function Ft(n){return n<0?0:n>1?1:n}function pt(n){var t=n;return t.length&&t.charAt(t.length-1)==="%"?X(parseFloat(t)/100*255):X(parseInt(t,10))}function F(n){var t=n;return t.length&&t.charAt(t.length-1)==="%"?Ft(parseFloat(t)/100):Ft(parseFloat(t))}function gt(n,t,e){return e<0?e+=1:e>1&&(e-=1),e*6<1?n+(t-n)*e*6:e*2<1?t:e*3<2?n+(t-n)*(.6666666666666666-e)*6:n}function T(n,t,e,i,s){return n[0]=t,n[1]=e,n[2]=i,n[3]=s,n}function ft(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n}var Wt=new Te(20),Q=null;function B(n,t){Q&&ft(Q,t),Q=Wt.put(n,Q||t.slice())}function xe(n,t){if(n){t=t||[];var e=Wt.get(n);if(e)return ft(t,e);n=n+"";var i=n.replace(/ /g,"").toLowerCase();if(i in Xt)return ft(t,Xt[i]),B(n,t),t;var s=i.length;if(i.charAt(0)==="#"){if(s===4||s===5){var r=parseInt(i.slice(1,4),16);if(!(r>=0&&r<=4095)){T(t,0,0,0,1);return}return T(t,(r&3840)>>4|(r&3840)>>8,r&240|(r&240)>>4,r&15|(r&15)<<4,s===5?parseInt(i.slice(4),16)/15:1),B(n,t),t}else if(s===7||s===9){var r=parseInt(i.slice(1,7),16);if(!(r>=0&&r<=16777215)){T(t,0,0,0,1);return}return T(t,(r&16711680)>>16,(r&65280)>>8,r&255,s===9?parseInt(i.slice(7),16)/255:1),B(n,t),t}return}var o=i.indexOf("("),a=i.indexOf(")");if(o!==-1&&a+1===s){var h=i.substr(0,o),l=i.substr(o+1,a-(o+1)).split(","),c=1;switch(h){case"rgba":if(l.length!==4)return l.length===3?T(t,+l[0],+l[1],+l[2],1):T(t,0,0,0,1);c=F(l.pop());case"rgb":if(l.length>=3)return T(t,pt(l[0]),pt(l[1]),pt(l[2]),l.length===3?c:F(l[3])),B(n,t),t;T(t,0,0,0,1);return;case"hsla":if(l.length!==4){T(t,0,0,0,1);return}return l[3]=F(l[3]),jt(l,t),B(n,t),t;case"hsl":if(l.length!==3){T(t,0,0,0,1);return}return jt(l,t),B(n,t),t;default:return}}T(t,0,0,0,1)}}function jt(n,t){var e=(parseFloat(n[0])%360+360)%360/360,i=F(n[1]),s=F(n[2]),r=s<=.5?s*(i+1):s+i-s*i,o=s*2-r;return t=t||[],T(t,X(gt(o,r,e+.3333333333333333)*255),X(gt(o,r,e)*255),X(gt(o,r,e-.3333333333333333)*255),1),n.length===4&&(t[3]=n[3]),t}function _e(n,t){var e=xe(n);if(e){for(var i=0;i<3;i++)t<0?e[i]=e[i]*(1-t)|0:e[i]=(255-e[i])*t+e[i]|0,e[i]>255?e[i]=255:e[i]<0&&(e[i]=0);return Me(e,e.length===4?"rgba":"rgb")}}function Me(n,t){if(!(!n||!n.length)){var e=n[0]+","+n[1]+","+n[2];return(t==="rgba"||t==="hsva"||t==="hsla")&&(e+=","+n[3]),t+"("+e+")"}}const Z=class M{constructor(){this.type=M.type,this.dom=this.createTooltip()}static getInstance(){return M.instance}hide(){this.dom||(this.dom=this.createTooltip()),this.dom.classList.add("hide")}show(t,e,i){this.dom||(this.dom=this.createTooltip()),this.dom.classList.remove("hide"),this.dom.innerHTML=i;let s=window.innerWidth;e<=this.dom.clientHeight?this.dom.style.top=e+"px":this.dom.style.top=e-this.dom.clientHeight+"px",t+this.dom.clientWidth<=s?this.dom.style.left=t+"px":this.dom.style.left=t-this.dom.clientWidth+"px"}static forbid(){M.forbidden=!0}static allow(){M.forbidden=!1}refresh(){}setOption(t){}createTooltip(){if(this.dom)return this.dom;let t=document.body;if(!t)return null;let e=document.createElement("div");return e.classList.add("tooltip","hide"),t.append(e),e}static init(t){let e=t.onmouseover,i=t.onmouseout;t.onmouseover=s=>{e&&e(s),!M.forbidden&&M.getInstance().show(s.event.clientX,s.event.clientY,t.getTooltip())},t.onmouseout=s=>{i&&i(s),M.getInstance().hide()}}static initElement(t,e){let i=t.onmouseover,s=t.onmouseout;t.onmouseover=r=>{i&&i(r),!M.forbidden&&M.getInstance().show(r.event.clientX,r.event.clientY,e)},t.onmouseout=r=>{s&&s(r),M.getInstance().hide()}}setTheme(t,e){}};Z.type="Tooltip",Z.instance=new Z;let tt=Z;class Ce{render(t,e){if(!t)return[];let i=this,s=new P;return t.metaDataList.forEach((r,o)=>{let a=new P;r.forEach((h,l)=>{a.addHorizon(i.paint(h,t.styleProperties))}),s.addVertical(a)}),[s]}paint(t,e){let i=new zrender.Group;i.dirty();let s=d({},t.style),r=t.baseWidth||ht.cellWidth,o=s.height||ht.cellHeight,a=r*t.counts+(t.counts*(e.border+e.padding)-((s.padding||0)+(s.borderWidth||.5)*2)),h=null;return i.add(h=new zrender.Text({style:d({text:t.text,width:a,x:.5*a,height:o,align:"center",lineHeight:o,fontSize:12,backgroundColor:"#1ba78480",borderColor:"#1ba784",overflow:"truncate",borderWidth:.5,borderRadius:3},t.style)})),Yt(h,"style",{backgroundColor:_e(h.style.backgroundColor,.2)}),tt.initElement(i,t.text),i}}class ze extends G{constructor(t,e){super(t||{},t||{}),this.timeScale=e}setTimeScale(t){this.timeScale=t}setTable(t){this.table=t}refresh(){this.initMetaData()}initMetaData(){let t=this.initCol(),e={value:[]};this.table&&(e=this.initRow()),this.metaData={col:t,row:e}}initCol(){let t=100;this.table&&(t=this.table.getHeight());let e=[],r=this.timeScale.tierContainer.getContainerByName(this.timeScale.type).childAt(0).children().reduce((a,h)=>a.childCount()>=h.childCount()?a:h),o=d(d({},this.originOption.style||{}),this.originOption.colStyle||{});return r.eachChild(a=>{e.push({x1:a.x,x2:a.x,y1:0,y2:t})}),{value:e,style:o}}initRow(){let t=this.timeScale.getTimeLineWidth(),e=[],i,s,r=d(d({},this.originOption.style||{}),this.originOption.rowStyle||{}),o=this.table.rowGroup,a=o.y+o.parent.y;return o.eachChild(h=>{i=h.getBoundingRect(),s=a+h.y+i.height,e.push({x1:0,x2:t||1e3,y1:s,y2:s})}),{value:e,style:r}}}class De{render(t,e){let i=new zrender.Group({silent:!1}),s=t.metaData;s.row&&i.add(this.paintRow(s.row)),s.col&&i.add(this.paintCol(s.col));let r=i.getBoundingRect();return i.add(new zrender.Rect({shape:{width:r.width,height:r.height},style:{fill:t.originOption.backGroundColor||"#ffffff00"},zlevel:-1})),[i]}paintRow(t){let e=new zrender.Group;return t.value.forEach(i=>{e.add(new zrender.Line({shape:i,style:d({stroke:"#acacac",lineDash:"dashed",lineWidth:1},t.style)}))}),e}paintCol(t){let e=new zrender.Group;return t.value.forEach(i=>{e.add(new zrender.Line({shape:i,style:d({stroke:"#acacac",lineDash:"dashed",lineWidth:1},t.style)}))}),e}}class Oe{constructor(t,e){this.timeScale=e,this.model=new ze(t,e),this.view=new De}setTimeScale(t){this.timeScale=t,this.model.setTimeScale(t)}setTable(t){this.table=t,this.model.setTable(t)}setContainer(t){this.container=t}refresh(){if(!this.container)return;let t=this;this.container.removeAll(),this.model.refresh(),this._uiInstance=this.view.render(this.model,this.zrInstance),this._uiInstance.forEach(e=>{t.container.addVertical(e)})}setOption(t){this.model.originOption=t,this.model.fullOption=t}setTheme(t){}}class et extends dt{constructor(t){super(),this.tierList=[],this.tierNameMap=new Map,this.tier=t||1,this.initTiers()}addTier(t,e){if(t){if(this.tierNameMap.has(e))throw new Error(`The container named ${e} is exited.(名为${e}的容器已存在)`);this.tier++,this.tierNameMap.set(e,this.tier),this.tierList.push(t),this.add(t)}}addTo(t,e){let i=this.getContainer(e);if(!i)throw new Error(`The container of tier ${e} is not exit.(层级为${e}的容器不存在)`);i.add(t)}addToByName(t,e){let i=this.getContainerByName(e);if(!i)throw new Error(`The container named ${e} is not exit.(名为为${e}的容器不存在)`);i.add(t)}addHorizonTo(t,e){let i=this.getContainer(e);if(!i)throw new Error(`The container of tier ${e} is not exit.(层级为${e}的容器不存在)`);i.addHorizon(t)}addHorizonToByName(t,e){let i=this.getContainerByName(e);if(!i)throw new Error(`The container named ${e} is not exit.(名为为${e}的容器不存在)`);i.addHorizon(t)}addVerticalTo(t,e){let i=this.getContainer(e);if(!i)throw new Error(`The container of tier ${e} is not exit.(层级为${e}的容器不存在)`);i.addVertical(t)}addVerticalToByName(t,e){let i=this.getContainerByName(e);if(!i)throw new Error(`The container named ${e} is not exit.(名为为${e}的容器不存在)`);i.addVertical(t)}getContainer(t){return this.tierList[t-1]}getContainerByName(t){let e=this.tierNameMap.get(t);return e?this.tierList[e-1]:null}refresh(){this.tierList.forEach(t=>{t.refresh()})}setTierName(t,e){this.tierNameMap.set(e,t),this.tierNameMap.delete(t)}setTierContainer(t,e){if(t<=0)throw new Error("Value of tier required a number greater than zero.(tier需要是一个大于零的数)");this.tierList[t-1]=e,this.reAddChild()}setTierContainerByName(t,e){let i=this.tierNameMap.get(t);if(i)throw new Error(`The container named ${t} is not exit.(名为${t}的容器不存在)`);this.tierList[i-1]=e}initTiers(){let t=null;for(let e=0;e<this.tier;e++)this.tierList.push(t=new P),this.tierNameMap.set(e+1,e+1),this.add(t)}reAddChild(){this.removeAll();let t=this;this.tierList.forEach(e=>{t.add(e)})}}const qt=class Ct extends G{constructor(t,e){super(t||{},e||{})}setScroll(t){this.scroll=t}setOption(t){this.originOption=t,this.fullOption=t}setContainer(t){this.container=t}refresh(){this.scrollForContainer()}scrollTo(t){this.container=t,this.scrollForContainer()}scrollForContainer(){this.container&&(this.createScrollHorizon(),this.createScrollVertical())}createScrollHorizon(){if(this.container.realWidth-this.container.__width<=0){this.horizon=null;return}this.horizon={type:"horizon",trackLength:this.container.__width,thumbLength:Math.round(this.container.__width/this.container.realWidth*this.container.__width),trackStyle:this.originOption.trackStyle||{},thumbStyle:this.originOption.thumbStyle||{},height:this.originOption.thickness||Ct.scrollLength}}createScrollVertical(){if(this.container.realHeight-this.container.__height<=0){this.vertical=null;return}this.vertical={type:"vertical",trackLength:this.container.__height,thumbLength:Math.round(this.container.__height/this.container.realHeight*this.container.__height),trackStyle:this.originOption.trackStyle||{},thumbStyle:this.originOption.thumbStyle||{},width:this.originOption.thickness||Ct.scrollLength}}};qt.scrollLength=8;let Re=qt;class Vt extends zrender.Rect{constructor(t,e){super(t),this.type=e,this.draggable=!1,this.initEvent()}initEvent(){let t=this,e,i;t.onmousedown=s=>{s.event.preventDefault();let r=t.parent.parent;e=r.realWidth/r.__width,i=r.realHeight/r.__height,t.isMouseDown=!0,document.onmousemove=o=>{if(o.preventDefault(),t.isMouseDown){t.dirty();let a=0;if(t.type==="horizon"){let l=t.scroll.horizonTarget||r.childAt(0);if(t.x+o.movementX+t.getBoundingRect().width>r.__width||t.x+o.movementX<0)return;a=o.movementX,t.setPosition([t.x+o.movementX,t.y]),l.setPosition([l.x-o.movementX*e,l.y])}if(t.type==="vertical"){let l=t.scroll.verticalTarget||r.childAt(0);if(t.y+o.movementY+t.getBoundingRect().height>r.__height||t.y+o.movementY<0)return;a=o.movementY,t.setPosition([t.x,t.y+o.movementY]),l.setPosition([l.x,l.y-o.movementY*i])}let h=t.scroll.items;h&&h.forEach(l=>{t.type==l.type&&l.scroll.moveTo(l.type,a,!0)})}},document.onmouseup=o=>{o.preventDefault(),t.isMouseDown=!1,document.onmousemove=null,document.onmouseup=null}}}scrollTo(t,e){let i=this,s,r,o=i.parent.parent;if(!o)return;s=o.realWidth/o.__width,r=o.realHeight/o.__height;let a=0;if(i.dirty(),i.type==="horizon"){let h=i.scroll.horizonTarget||o.childAt(0);if(i.x+t+i.getBoundingRect().width>o.__width||i.x+t<0)return;a=t*s,i.setPosition([i.x+t,i.y]),h.setPosition([h.x-a,h.y])}if(i.type==="vertical"){let h=i.scroll.verticalTarget||o.childAt(0);if(i.y+t+i.getBoundingRect().height>o.__height||i.y+t<0)return;a=t*r,i.setPosition([i.x,i.y+t]),h.setPosition([h.x,h.y-a])}if(!e){let h=i.scroll.items;h&&h.forEach(l=>{i.type==l.type&&l.scroll.moveTo(l.type,t,!0)})}return a}}const x=class zt extends zrender.Group{constructor(t,e,i,s){super(),this.scroll=s,this.track=t,this.thumb=e,this.type=i,this.thumb.scroll=this.scroll,this.init()}setHoverOffset(t){this.offset=t,this.init()}init(){this.type=="horizon"?this.trackLength=this.track.shape.height:this.trackLength=this.track.shape.width,this.type=="horizon"?this.thumbLength=this.thumb.shape.height:this.thumbLength=this.thumb.shape.width,this.type=="horizon"?this.trackPosition=this.track.shape.y:this.trackPosition=this.track.shape.x,this.type=="horizon"?this.thumbPosition=this.thumb.shape.y:this.thumbPosition=this.thumb.shape.x,this.add(this.track),this.add(this.thumb),this.initHover()}initHover(){let t=this.offset||8,e=this;this.onmouseover=i=>{e.hovered||(i.event.preventDefault(),zt.mouseoverHandler[this.type](e,t),this.hovered=!0)},this.onmouseout=i=>{this.thumb.contain(i.event.zrX,i.event.zrY)||this.track.contain(i.event.zrX,i.event.zrY)||(i.event.preventDefault(),zt.mouseoutHandler[this.type](e,t),this.hovered=!1)}}};x.duration=120,x.mouseoverHandler={horizon:(n,t)=>{let e=U.getInstance(),i=null;i=e.getAnimate(n.track,"mouseover"),i||(i=e.addAnimate(n.track,"mouseover",n.track.animate("shape",!1).when(x.duration,{y:n.trackPosition-t,height:n.trackLength+t}).done(()=>{n.track.attr({shape:{y:n.trackPosition-t,height:n.trackLength+t}})})));let s=null;s=e.getAnimate(n.thumb,"mouseover"),s||(s=e.addAnimate(n.thumb,"mouseover",n.thumb.animate("shape",!1).when(x.duration,{y:n.thumbPosition-t,height:n.thumbLength+t}).done(()=>{n.thumb.attr({shape:{y:n.thumbPosition-t,height:n.thumbLength+t}})}))),n.track.updateDuringAnimation("shape"),n.thumb.updateDuringAnimation("shape"),i.start(),s.start()},vertical:(n,t)=>{let e=U.getInstance(),i=null;i=e.getAnimate(n.track,"mouseover"),i||(i=e.addAnimate(n.track,"mouseover",n.track.animate("shape",!1).when(x.duration,{x:n.trackPosition-t,width:n.trackLength+t}).done(()=>{n.track.attr({shape:{x:n.trackPosition-t,width:n.trackLength+t}})})));let s=null;s=e.getAnimate(n.thumb,"mouseover"),s||(s=e.addAnimate(n.thumb,"mouseover",n.thumb.animate("shape",!1).when(x.duration,{x:n.thumbPosition-t,width:n.thumbLength+t}).done(()=>{n.thumb.attr({shape:{x:n.thumbPosition-t,width:n.thumbLength+t}})}))),n.track.updateDuringAnimation("shape"),n.thumb.updateDuringAnimation("shape"),i.start(),s.start()}},x.mouseoutHandler={horizon:(n,t)=>{let e=U.getInstance(),i=null;i=e.getAnimate(n.track,"mouseout"),i||(i=e.addAnimate(n.track,"mouseout",n.track.animate("shape",!1).when(x.duration,{y:n.trackPosition,height:n.trackLength}).done(()=>{n.track.attr({shape:{y:n.trackPosition,height:n.trackLength}})})));let s=null;s=e.getAnimate(n.thumb,"mouseout"),s||(s=e.addAnimate(n.thumb,"mouseout",n.thumb.animate("shape",!1).when(x.duration,{y:n.thumbPosition,height:n.thumbLength}).done(()=>{n.thumb.attr({shape:{y:n.thumbPosition,height:n.thumbLength}})}))),n.track.updateDuringAnimation("shape"),n.thumb.updateDuringAnimation("shape"),i.start(),s.start()},vertical:(n,t)=>{let e=U.getInstance(),i=null;i=e.getAnimate(n.track,"mouseout"),i||(i=e.addAnimate(n.track,"mouseout",n.track.animate("shape",!1).when(x.duration,{x:n.trackPosition,width:n.trackLength}).done(()=>{n.track.attr({shape:{x:n.trackPosition,width:n.trackLength}})})));let s=null;s=e.getAnimate(n.thumb,"mouseout"),s||(s=e.addAnimate(n.thumb,"mouseout",n.thumb.animate("shape",!1).when(x.duration,{x:n.thumbPosition,width:n.thumbLength}).done(()=>{n.thumb.attr({shape:{x:n.thumbPosition,width:n.thumbLength}})}))),n.track.updateDuringAnimation("shape"),n.thumb.updateDuringAnimation("shape"),i.start(),s.start()}};let $t=x;class Ee{render(t,e){let i=[];return t.horizon&&i.push(this.paintHorizon(t)),t.vertical&&i.push(this.paintVertical(t)),i}paintHorizon(t){let e=new zrender.Rect({shape:{width:t.horizon.trackLength,height:t.horizon.height},style:d({fill:"#acacac60"},t.horizon.trackStyle)}),i=new Vt({shape:{y:2,x:2,width:t.horizon.thumbLength,height:t.horizon.height-4},style:d({fill:"#acacac"},t.horizon.thumbStyle)},"horizon"),s=new $t(e,i,"horizon",t.scroll);return s.setHoverOffset(t.originOption.hoverOffset),t.scroll.setHorizonScroll(s),t.container.addBottom(s),s}paintVertical(t){let e=new zrender.Rect({shape:{height:t.vertical.trackLength,width:t.vertical.width},style:d({fill:"#acacac60"},t.vertical.trackStyle)}),i=new Vt({shape:{y:2,x:2,height:t.vertical.thumbLength,width:t.vertical.width-4},style:d({fill:"#acacac"},t.vertical.thumbStyle),draggable:!0},"vertical"),s=new $t(e,i,"vertical",t.scroll);return s.setHoverOffset(t.originOption.hoverOffset),t.scroll.setVerticalScroll(s),t.container.addRight(s),s}}class Ie{constructor(t,e){this.items=new Set,this.model=new Re(t,t),this.model.setScroll(this),this.view=new Ee,this.model.setContainer(e)}setView(t){this.view=t}setModel(t){this.model=t}setTheme(t){}setTarget(t,e){t=="horizon"?(this.horizonTarget=e,this.horizonPos=[e.x,e.y]):(this.verticalTarget=e,this.verticalPos=[e.x,e.y])}setVerticalScroll(t){this.verticalScroll=t,t.scroll=this}setHorizonScroll(t){this.horizonScroll=t,t.scroll=this}refresh(){this._uiInstance&&this._uiInstance.forEach(t=>{t.parent.remove(t)}),this.model.refresh(),this._uiInstance=this.view.render(this.model,null),this.resetPosition()}horizonMove(t,e){return this.horizonScroll.thumb.scrollTo(t,e)}verticalMove(t,e){return this.verticalScroll.thumb.scrollTo(t,e)}moveTo(t,e,i){return t=="horizon"?this.horizonMove(e,i):this.verticalMove(e,i)}resetPosition(){this.horizonTarget?this.horizonTarget.setPosition(this.horizonPos||[0,0]):this._uiInstance[0]&&this._uiInstance[0].parent.childAt(0).setPosition([0,0]),this.verticalTarget?this.verticalTarget.setPosition(this.verticalPos||[0,0]):this._uiInstance[1]&&this._uiInstance[1].parent.childAt(0).setPosition([0,0])}setOption(t){this.model.fullOption=t,this.model.originOption=t}}const mt=class ce{static getInstance(){return ce.instance}constructor(){}publishedEvent(t){if(!t||!this.listenerMap)return;let e=this.listenerMap.get(t.type),i=this.extraActionMap;e&&e.forEach(s=>{s.handleEvent(t);let r=i.get(s);r&&r.forEach(o=>{o.action(s,o.target)})})}registerListener(t){if(!t)return;!this.listenerMap&&this.initListenerMap();let e=this.listenerMap.get(t.eventType);e||(e=[],this.listenerMap.set(t.eventType,e)),e.push(t)}registerListenerByType(t,e){if(!t)return;!this.listenerMap&&this.initListenerMap();let i=this.listenerMap.get(e);t||(i=[],this.listenerMap.set(e,i)),i.push(t)}removeListener(t){let e;if(this.listenerMap&&(e=this.listenerMap.get(t.eventType))){let i=e.indexOf(t);i>=0&&e.splice(i,1)}}removeListenerByType(t,e){let i;if(this.listenerMap&&(i=this.listenerMap.get(e))){let s=i.indexOf(t);s>=0&&i.splice(s,1)}}registerAction(t,e){let i=this.extraActionMap.get(t);i||(i=[],this.extraActionMap.set(t,i)),i.push(e)}initListenerMap(){this.listenerMap=new Map,this.extraActionMap=new Map}};mt.instance=new mt;let A=mt;const Nt=class de extends P{constructor(t,e,i,s){super(),this.type=de.type,this.__origin_width=t,this.__origin_height=e,this.__overflow=i,this.__scrollOption=s||{},this.calcWeightAndHeight(),this.initContentGroup(),this.refreshClipPath(),this.initEvent(),A.getInstance().registerListener(this)}setScrollerOption(t){this.__scrollOption=t,this.__scroll.setOption(t)}initContentGroup(){this.__content=new W(this),this.add(this.__content)}refreshClipPath(){this.__clipPath=new zrender.Rect({shape:{width:this.__width,height:this.__height}}),this.setClipPath(this.__clipPath)}add(t){let e=super.add(t);return this.refreshScroll(),e}addContent(t){let e=new W(this);e.add(t);let i=this.__content.add(e);return this.realWidth=super.getBoundingRect().width,this.realHeight=super.getBoundingRect().height,this.refreshScroll(),i}addContentHorizon(t){let e=new W(this);e.add(t);let i=this.__content.addHorizon(e);return this.realWidth=super.getBoundingRect().width,this.realHeight=super.getBoundingRect().height,this.refreshScroll(),i}addContentVertical(t){let e=new W(this);e.add(t);let i=this.__content.addVertical(e);return this.realWidth=super.getBoundingRect().width,this.realHeight=super.getBoundingRect().height,this.refreshScroll(),i}bindScroll(t,e){!this.__scroll||!e.__scroll||(this.__scroll.items.add({type:t,scroll:e.__scroll}),e.__scroll.items.add({type:t,scroll:this.__scroll}))}addChild(t,e){let i=super.add(t);return e&&this.refreshScroll(),i}addBottom(t){let e=t.getBoundingRect().height;return t.setPosition([0,this.__height-e]),this.addChild(t,!1)}addRight(t){let e=t.getBoundingRect().width;return t.setPosition([this.__width-e,0]),this.addChild(t,!1)}refresh(){super.refresh()}resize(t,e){super.resize(t,e),t&&(this.__origin_width=t),e&&(this.__origin_height=e),this.calcWeightAndHeight(),this.refreshClipPath(),this.refreshScroll(),this.__scroll&&this.__scroll.resetPosition()}getBoundingRect(t){return this.__clipPath?this.__clipPath.getBoundingRect():new zrender.BoundingRect(0,0,this.__width,this.__height)}getOriginBoundingRect(t){return super.getBoundingRect(t)}calcWeightAndHeight(){if(this.__width=parseFloat(this.__origin_width),this.__height=parseFloat(this.__origin_height),this.parent&&this.parent instanceof W){let t=this.parent.container;L(this.__origin_width)&&(this.__width=t.__width*(parseFloat(this.__origin_width.split("%")[0])/100)),L(this.__origin_height)&&(this.__height=t.__height*(parseFloat(this.__origin_height.split("%")[0])/100))}}refreshScroll(){this.__overflow!="hidden"&&(!this.__scroll&&(this.__scroll=new Ie(this.__scrollOption||{},this)),this.__scroll.model.setOption(this.__scrollOption),this.__scroll.refresh())}initEvent(){let t=this;this.onmousewheel=e=>{e.stop(),e.event.preventDefault(),t.__scroll&&(e.event.shiftKey?t.__scroll.moveTo("horizon",-5*e.wheelDelta):t.__scroll.moveTo("vertical",-5*e.wheelDelta))}}};Nt.type="FixedContainer";let yt=Nt;class W extends P{constructor(t){super(),this.container=t}}class Le{constructor(t){this.timeScale=t}refresh(){this.initStartPosition(),this.initAccuracy()}setTimeScale(t){this.timeScale=t}xToDate(t){let e=Math.floor(t/this.accuracy);return u(this.timeScale.model.start).add(e,this.accuracyUnit).toDate()}dateToX(t){return t?Math.ceil(u(t).diff(u(this.startDate),this.accuracyUnit))*this.accuracy:void 0}initStartPosition(){this.startDate=this.timeScale.model.start,this.startPosition=this.timeScale.container.x}initAccuracy(){this.accuracyUnit=this.timeScale.model.fullOption.accuracy;let t=1e13,e=this.timeScale.getTimeLineWidth(),i=u(this.timeScale.model.end).diff(u(this.timeScale.model.start),this.accuracyUnit);this.accuracy=Math.round(e/i*t)/t}initEvent(){let t=this;this.timeScale.container.onclick=e=>{let i=t.timeScale.container.__content.x,s=e.event.zrX-t.startPosition-i;console.log(s,t.xToDate(s).toLocaleString())}}}const Kt=class nt{constructor(){this.componentMap=new Map}static registerInstance(t){nt.instanceMap.set(t,new nt)}static getInstance(t){return nt.instanceMap.get(t)}componentRegister(t,e){this.componentMap.set(t,e)}getComponent(t){return this.componentMap.get(t)}};Kt.instanceMap=new Map;let y=Kt;class Pe{}const Jt=class ue extends Pe{constructor(t){super(),this.type=ue.type,this.date=u(t.date).toDate(),this.lineStyle=t.lineStyle,this.textStyle=t.textStyle,this.length=t.length,this.content=t.text}paint(){let t=this,e=y.getInstance(this.jcGantt).getComponent(C.type),i=e.getTimeLineHeight(),r=e.coord.dateToX(this.date);return this.group=new zrender.Group({silent:!0}),this.line=new zrender.Line({shape:{x1:r,y1:i,x2:r,y2:t.length},style:d({lineWidth:1.2,lineDash:"dashed",stroke:"#000"},t.lineStyle)}),this.text=new zrender.Text({style:d({x:r,y:t.length,text:t.content,padding:5,backgroundColor:"#acacac",align:"center"},t.textStyle)}),this.group.add(this.line),this.group.add(this.text),this.group}};Jt.type="DateMark";let Ut=Jt;const Qt=class Dt{constructor(){}static registerMarkType(t,e){Dt.typeMap.set(t,e)}static getMarkItem(t,e){let i=null,s=Dt.typeMap.get(t);return k(s)&&(i=s(e)),i}};Qt.typeMap=new Map().set(Ut.type,n=>new Ut(n));let Be=Qt;class Ae extends G{constructor(t){super(t,t),this.items=[]}init(){let t=this;if(this.items=[],this.originOption.marks){let e=null;this.originOption.marks.forEach(i=>{e=Be.getMarkItem(i.type,i.arg),e&&(e.jcGantt=t.jcGantt,t.items.push(e))})}}refresh(){this.init()}setOption(t){this.originOption=t}}class He{render(t,e){let i=new zrender.Group;return t.items.forEach(s=>{i.add(s.paint())}),[i]}}const Zt=class pe{constructor(t,e){this.type=pe.type,this.jcGantt=t,this.option=m(e),this.model=new Ae(e),this.model.jcGantt=this.jcGantt,this.view=new He,this.container=y.getInstance(this.jcGantt).getComponent(C.type).getMarkContainer()}refresh(){this.container||(this.container=y.getInstance(this.jcGantt).getComponent(C.type).getMarkContainer()),this.container.removeAll(),this.model.refresh(),this._uiInstance=this.view.render(this.model,null),this._uiInstance.forEach(t=>{this.container.add(t)})}setOption(t){}setTheme(t,e){}};Zt.type="Mark";let wt=Zt;const vt=class Ot{static getInstance(){return Ot.instance}constructor(){this.dom=this.createContextMenu()}show(t,e,i){this.dom.remove(),this.dom=null,this.dom||(this.dom=this.createContextMenu());let s=this;i&&i.length&&i.forEach(a=>{s.addItem(a)}),this.dom.classList.remove("hide_real");let r=window.innerWidth;window.innerHeight>=e+this.dom.clientHeight?this.dom.style.top=e+"px":this.dom.style.top=e-this.dom.clientHeight+"px",t+this.dom.clientWidth<=r?this.dom.style.left=t+"px":this.dom.style.left=t-this.dom.clientWidth+"px"}hide(){this.dom||(this.dom=this.createContextMenu()),this.dom.classList.add("hide_real")}refresh(){}setOption(t){}setTheme(t,e){}createContextMenu(){if(this.dom)return this.dom;let t=document.body;if(!t)return null;let e=document.createElement("div");return e.classList.add("content-menu","hide_real"),t.append(e),e}addItem(t){let e=document.createElement("div");e.classList.add("content-menu-item"),t.cls&&e.classList.add(t.cls);let i=t.style?t.style():{};for(let a in i)e.style[a]=i[a];t.disabled&&t.disabled()&&e.classList.add("content-menu-item-forbid"),e.onclick=function(){t.handler&&t.handler(),Ot.getInstance().hide()};let s=document.createElement("i");s.classList.add("content-menu-item-icon");let r=document.createElement("img");t.icon&&(r.src=t.icon),s.append(r),e.append(s);let o=document.createElement("span");o.classList.add("content-menu-item-text"),o.innerHTML=t.text||"",e.append(o),this.dom.append(e)}};vt.instance=new vt;let O=vt;const j=class st{constructor(t,e){this.type=st.type,this.zrInstance=t;let i=d(d({},st.defaultOption),e);this.model=new ke(i),this.view=new Ce,this.container=new yt(i.width,i.height),this.container.setScrollerOption(i.scroll),this.tierContainer=new et(3),this.tierContainer.setTierName(1,st.background),this.tierContainer.setTierContainer(1,new et(2)),this.tierContainer.setTierName(2,this.type),this.backGround=new Oe(this.model.fullOption.grid,this),this.container.setComponent(this.backGround),this.coord=new Le(this),this.container.__scroll.setTarget("vertical",this.tierContainer.getContainer(1)),this.initEvent(),A.getInstance().registerAction(this.container,{target:this.coord,action:(s,r)=>{r.refresh()}})}getOffsetX(){return this.container.__content.x}getOffsetY(){return this.tierContainer.getContainer(1).y}getMarkContainer(){return this.tierContainer.getContainer(3)}getTimeLineContainer(){return this.tierContainer.getContainer(2)}getTimeLineHeight(){return this.getTimeLineContainer().getBoundingRect().height}getTimeLineWidth(){return this.getTimeLineContainer().getBoundingRect().width}getStartX(){return this.container.x}getBackGroundContainer(){return this.tierContainer.getContainer(1).getContainer(1)}getTaskContainer(){return this.tierContainer.getContainer(1).getContainer(2)}setTable(t){this.table=t}isEdge(t,e){let i=this.getStartX(),s=this.getTimeLineHeight(),r=this.container.__width-10,o=this.container.__height-s-10;return t-i<=0?"left":t-i>=r?"right":e-s<=0?"top":e-s>=o?"bottom":null}zoom(t){if(t<=0)throw new Error("The value of multiple must be a number greater than zero.(放大倍速必须是一个大于零的整数)");this.model._timeBase=this.model._timeBase*t,this.refresh()}setDateRange(t,e){this.model.fullOption.start=t,this.model.fullOption.end=e,this.model.fullOption.days=-60,this.refresh()}setTimeUnit(t,e){this.model._timeBase=t,this.model._timeUnit=e,this.refresh()}refresh(){let t=this;this.model.refresh(),this.tierContainer.getContainerByName(this.type).removeAll(),this._uiInstance=this.view.render(this.model,this.zrInstance),this._uiInstance.forEach(i=>{t.tierContainer.addHorizonToByName(i,t.type)}),this.backGround&&(this.backGround.setContainer(this.getBackGroundContainer()),this.backGround.refresh()),this.container.addContent(this.tierContainer),this.coord.refresh();let e=y.getInstance(this.jcGantt).getComponent(wt.type);e&&e.refresh(),this.taskBuilder&&this.taskBuilder.refresh()}setTheme(t,e){if(this.model.fullOption=m(this.model.option),t){let i=m(t),s=i.timeLine.scales;delete i.timeLine.scales;let r=this.model.fullOption;D(i.timeLine,r,e),r.scales&&r.scales.forEach(o=>{D(s,o,e)})}this.model.originOption=this.model.fullOption,this.container.setScrollerOption(this.model.fullOption.scroll),this.container.__scroll.refresh(),this.backGround.setOption(this.model.fullOption.grid),this.taskBuilder.setTheme(t,e),this.refresh()}setOption(t){}initEvent(){let t=this,e=this.container.onmousewheel;this.container.onmousewheel=i=>{i.stop(),i.event.preventDefault(),i.event.ctrlKey?i.wheelDelta<0?t.zoom(1.1):t.zoom(.9):e&&e(i)},this.initContentMenu()}initContentMenu(){let t=this;this.container.oncontextmenu=e=>{e.stop(),e.event.preventDefault(),t.model.originOption.contextmenu?O.getInstance().show(e.event.clientX,e.event.clientY,t.model.originOption.contextmenu):O.getInstance().hide()}}};j.type="timeScale",j.background="background",j.defaultFormatter={second:"YY/MM/DD HH:mm:ss",minute:"YY/MM/DD HH:mm",hour:"YY/MM/DD HH时",day:"YY/MM/DD",week:"YY年W周",month:"YY年MM月",year:"YYYY年"},j.defaultOption={width:"80%",height:"100%",baseWidth:65,accuracy:"second",days:60,grid:{},scales:[{symbol:"day",formatter:"yy/MM/DD",commonStyle:{backgroundColor:"#1ba78480",borderColor:"#1ba784"},style:n=>{let t=u(n.start);if(u().isBetween(t,u(n.end),"minute","[]"))return{backgroundColor:"#bacf65"};if(t.day()!=6&&t.day()!=0)return{backgroundColor:"#f5960080"}}}],scroll:{thickness:6,hoverOffset:10,trackStyle:{fill:"#1ba78450"},thumbStyle:{fill:"#1ba78490"}}};let C=j;class Ye{constructor(t,e,i,s){this.tasks=[],this.keyId=i,this.container=new et(2),this.data=t,this.rowBuilder=e,this.render(s);let r=this,o=y.getInstance(this.rowBuilder.table.jcGantt).getComponent(q.type);this.container.onclick=a=>{a.stop(),a.event.preventDefault(),a.event.ctrlKey?o.ctrlSelect(r):a.event.shiftKey?o.shiftSelect(r):o.selectRow(r)}}render(t){let e=this.rowBuilder.colOpt,i=this,s=i.rowBuilder.rowOpt.height;e.forEach(r=>{i.container.addHorizonTo(new zrender.Text({silent:!0,style:d(d(d({text:i.data[r.prop],backgroundColor:"#ffffff00",width:r.width||100,x:r.width/2||50,height:s,lineHeight:s,fontSize:16,align:"center"},i.rowBuilder.rowOpt.commonStyle?i.rowBuilder.rowOpt.commonStyle.textStyle||{}:{}),i.rowBuilder.rowOpt.style?i.rowBuilder.rowOpt.style(i.data).textStyle:{}),t?t.textStyle:{})}),2)}),this.container.addTo(i.rect=new zrender.Rect({shape:{width:i.container.getBoundingRect().width,height:s},style:d(d(d({stroke:"#acacac",fill:"#fff"},i.rowBuilder.rowOpt.commonStyle?i.rowBuilder.rowOpt.commonStyle.rowStyle||{}:{}),i.rowBuilder.rowOpt.style?i.rowBuilder.rowOpt.style(i.data).rowStyle:{}),t?t.rowStyle:{})}),1),!t&&Yt(i.rect,"style",this.rowBuilder.rowOpt.hoverStyle.rowStyle)}getY(){return this.rowBuilder.table.rowGroup.parent.y+this.container.y}restoreStyle(){let t=this.rowBuilder.rowOpt,e=t.commonStyle||{},i=t.style,s;k(i)&&(s=i(this.data));let r=d(d({stroke:"#acacac",fill:"#fff"},e.rowStyle),s?s.rowStyle:{});this.rect.dirty(),this.rect.attr("style",r)}getTasks(){return this.tasks}getTaskByDate(t){let e=null,i,s,r,o=u(t);for(let a=0,h=this.tasks.length;a<h;a++)if(r=this.tasks[a],i=u(r.task.start),s=u(r.task.end),o.isBetween(i,s,"second","[]")){e=r;break}return e}}class Ge{constructor(t){this.table=t}createRow(t,e,i){return new Ye(t,this,e,i)}createHead(){}init(t,e,i){this.colOpt=t,this.rowOpt=e,this.background=i}}class Xe{constructor(t){this.rows=[],this.table=t,this.container=new et(2),this.tableRect=new zrender.Rect({shape:{width:t.container.__width,height:t.container.__height},style:d({fill:"none"},t.option.style)}),this.container.addTo(this.tableRect,1),this.rowBuilder=new Ge(this.table),this.rowBuilder.init(t.option.column,t.option.row,this.tableRect),this.rows=[]}render(){return oe(this,null,function*(){let t=this,e=this.rowBuilder,i={};this.table.option.column.forEach(a=>{i[a.prop]=a.name});let r,o=this.table.option.headStyle;this.table.timescale&&(r=this.table.timescale.tierContainer.getContainer(2).realHeight,o.textStyle.height=r,o.textStyle.lineHeight=r),this.addRow(new zrender.Group({silent:!0}).add(e.createRow(i,0,o).container)),yield this.table.getData().then(a=>{let h=new zrender.Group,l=new P,c,f=1;a.forEach(g=>{c=e.createRow(g,f++),t.rows.push(c),l.addVertical(c.container)}),h.add(l),h.setClipPath(new zrender.Rect({shape:{x:0,y:0,width:h.getBoundingRect().width,height:h.getBoundingRect().height}})),t.addRow(h)})})}addRow(t){this.container.addVerticalTo(t,2),this.updateTableRect()}getRowGroup(){return this.container.getContainer(2).childAt(1).childAt(0)}getHeadGroup(){return this.container.getContainer(2).childAt(0)}updateTableRect(){let t=this.container.getContainer(2).getBoundingRect().height,e=this.container.getContainer(2).getBoundingRect().width,i=this.tableRect.shape;i.height=t,i.width=e,this.tableRect.attr("shape",i)}}const kt=class Rt{constructor(t,e){this.type=Rt.type,this.rows=[],this.selections=[],this.timescale=e;let i=d(d({},Rt.defaultOption),t||{});this.option=i,this.originOption=m(i),this.container=new yt(i.width,i.height,"auto",i.scroll),this.container.setComponent(this),this.initContentMenu()}setTheme(t,e){this.option=m(this.originOption),t&&D(t.table,this.option,e),this.container.setScrollerOption(this.option.scroll),this.container.__scroll.refresh(),this.taskBuilder.setTheme(t,e),this.refresh()}getCurrentData(){let t=[],e;return this.getRows().forEach(s=>{e=s.data,e.tasks=[],s.tasks.forEach(r=>{r.task.start=u(r.task.start).format("yyyy/MM/DD HH:mm:ss"),r.task.end=u(r.task.end).format("yyyy/MM/DD HH:mm:ss"),e.tasks.push(r.task)}),t.push(e)}),t}setTimeScale(t){this.timescale=t,this.timescale.setTable(this),this.container.bindScroll("vertical",t.container)}refresh(){console.log("table refresh");let t=this,e=new Xe(this);e.render().then(()=>{t.container.__content.removeAll();let i=e.container;t.rows=e.rows,t.rowGroup=e.getRowGroup(),t.headGroup=e.getHeadGroup(),t.container.addContent(i),t.container.__scroll.setTarget("vertical",e.getRowGroup());let s=y.getInstance(t.jcGantt).getComponent(C.type);s.backGround.setTable(t),s.refresh(),t.selections=[]})}getData(){if(this.option.loadData){let t=this,e=this.timescale;return new Promise((i,s)=>{t.option.loadData(e?e.model.start:null,e?e.model.end:null,i)})}else return new Promise((t,e)=>{t(this.option.data?m(this.option.data):[])})}getRowOffsetY(){return this.rowGroup.y}getHeadHeight(){return this.headGroup.getBoundingRect().height}getHeight(){return this.getHeadHeight()+this.rowGroup.getBoundingRect().height}getRowByPos(t){let e=null;if(this.rows&&this.rows.length>0){let i,s,r;for(let o=0;o<this.rows.length;o++)if(i=this.rows[o],s=i.getY(),r=i.container.getBoundingRect().height,s<=t&&t<=s+r){e=i;break}}return e}clearSelections(){this.selections.length&&(this.selections.forEach(t=>{t.restoreStyle(),t.rect.hoverForbid=!1}),this.selections=[])}removeSelection(t){t.restoreStyle(),t.rect.hoverForbid=!1,this.selections.splice(this.selections.indexOf(t),1)}selectRow(t){t&&(t.rect.hoverForbid=!0,!(this.selections.length==1&&this.selections.indexOf(t)>=0)&&(this.clearSelections(),this.addRowToSelection(t)))}ctrlSelect(t){if(this.selections.length==0)return this.selectRow(t);if(this.selections.indexOf(t)>=0){this.removeSelection(t);return}this.addRowToSelection(t)}shiftSelect(t){if(this.selections.length==0)return this.selectRow(t);let e=this,i=this.selections[0].keyId,s=t.keyId,r=Math.max(i,s),o=Math.min(i,s);this.clearSelections(),this.rows.forEach(a=>{a.keyId>=o&&a.keyId<=r&&e.addRowToSelection(a)})}selectAll(){this.rows.forEach(t=>{this.addRowToSelection(t)})}getSelection(){return this.selections}updateData(t){this.option.data=t,this.refresh()}setOption(t){}getRows(){return this.rows}addRowToSelection(t){t.rect.hoverForbid=!0;let e=this.option.row.selectStyle,i;k(e)&&(i=e(t.data)),t.rect.dirty(),t.rect.attr("style",i&&i.rowStyle?i.rowStyle:{fill:"#f59600"}),this.selections.push(t)}initContentMenu(){let t=this;this.container.oncontextmenu=e=>{e.stop(),e.event.preventDefault(),t.originOption.contextmenu?O.getInstance().show(e.event.clientX,e.event.clientY,t.originOption.contextmenu):O.getInstance().hide()}}};kt.type="table",kt.defaultOption={show:!0,width:"20%",height:"100%",column:[{name:"姓名",prop:"name",width:100},{name:"年龄",prop:"age",width:50},{name:"家庭住址",prop:"addr",width:200},{name:"联系电话",prop:"phone",width:150}],row:{height:50,commonStyle:{textStyle:{fill:"#000",fontSize:20,borderColor:"#acacac",borderWidth:.1}},hoverStyle:{rowStyle:{fill:"#1ba78460"},textStyle:{fill:"#fff"}},quickTip:n=>{let t="";for(let e in n)t+=e+":"+n[e]+`
`;return t}},headStyle:{textStyle:{fontWeight:"bold",borderColor:"#1ba784",borderWidth:.1,backgroundColor:"#f5960080"},rowStyle:{fill:"#f5960000",stroke:"none"}},style:{stroke:"#1ba784"},scroll:{thickness:6,hoverOffset:10,trackStyle:{fill:"#1ba78450"},thumbStyle:{fill:"#1ba78490"}}};let q=kt;class Fe extends zrender.Rect{constructor(t){super(),this.source=t,this.init()}init(){if(!this.source)return;let t=this.source.getBoundingRect();this.shape={x:0,y:0,width:t.width,height:t.height},this.zlevel=999,this.style=this.source.style}}const te=class ge{constructor(t){this.type=ge.type,this.container=t,this.group=new zrender.Group,this.lineX=new zrender.Line({shape:{x1:this.startX,y1:this.startY,x2:this.startX,y2:this.endY},style:{stroke:"#00000090",lineWidth:1,lineDash:"dashed"},zlevel:1e3}),this.lineY=new zrender.Line({shape:{x1:this.startX,y1:this.startY,x2:this.endX,y2:this.startY},style:{stroke:"#00000090",lineWidth:1,lineDash:"dashed"},zlevel:1e3}),this.tipX=new zrender.Text({style:{x:this.endX,y:this.endY,text:"This is a tip for x axis",padding:5,backgroundColor:"#acacac"},zlevel:1e3}),this.tipY=new zrender.Text({style:{x:this.endX,y:this.endY,text:"This is a tip for y axis",padding:5,backgroundColor:"#acacac"},zlevel:1e3}),this.group.add(this.lineX),this.group.add(this.lineY),this.group.add(this.tipX),this.group.add(this.tipY),this.group.hide(),this.container.add(this.group)}setTheme(t){}addToContainer(){this.container.add(this.group)}setEnd(t,e){this.endX=t,this.endY=e}show(t,e,i,s,r){let o=y.getInstance(this.jcGantt).getComponent(C.type),a=o.getOffsetX(),h=o.getOffsetY();this.group.show(),this.startX=t,this.startY=e,this.lineX.attr("shape",{x1:this.startX,y1:this.startY,x2:this.startX,y2:this.endY-h}),this.lineY.attr("shape",{x1:this.startX,y1:this.startY,x2:this.endX-a,y2:this.startY}),this.tipX.attr("style",{x:this.startX,y:this.endY-h,text:i,backgroundColor:It[r]}),this.tipY.attr("style",{x:this.endX-a,y:this.startY,text:s,backgroundColor:It[r]})}hide(){this.group.hide()}refresh(){}setOption(t){}};te.type="AxisPoint";let it=te;class We extends zrender.Group{constructor(t,e,i,s,r,o,a,h,l){super(),this.jcGantt=t,this.container=e,this.option=i,this.row=s,this.task=r,this.x=o,this.y=a,this.width=h,this.height=l,this.init(),tt.init(this)}init(){let t=this;this.removeAll();let e=this.option;this.rect=new zrender.Rect({shape:{width:t.width,height:t.height},style:d({},k(e.taskStyle)?e.taskStyle(t.task,t.row.data):{})}),this.text=new zrender.Text({style:d({text:k(e.text)?e.text(t.task,t.row.data):t.task.text,x:t.width/2,width:t.width,height:t.height,align:"center",lineHeight:t.height,overflow:"truncate"},k(e.textStyle)?e.textStyle(t.task,t.row.data):{})}),this.add(this.rect),this.add(this.text),this.setPosition([t.x,t.y]),this.initEvent()}initMove(){let t=this;this.virtualItem||(t.virtualItem=new Fe(t.rect),t.add(t.virtualItem)),this.dragLine||(t.dragLine=new zrender.Line({style:{lineWidth:2,stroke:t.rect.style.fill,lineDash:"dashed"},zlevel:999}),t.add(t.dragLine))}initEvent(){let t=this;this.onmousedown=e=>{if(e.event.button||e.event.ctrlKey)return;e.stop(),e.event.preventDefault(),tt.forbid(),t.mousedown=!0;let i=t.width,s=t.height/2,r=e.offsetX,o=e.offsetY,a=!1,h,l,c;document.onmousemove=f=>{f.preventDefault(),this.initMove();let g=t.mouseMove(f,r,o,i,s);g&&(h=g.row,l=g.date,r=g.x,o=g.y,a=g.success,c=g.task)},document.onmouseup=f=>{if(f.preventDefault(),!t.mousedown)return;y.getInstance(t.jcGantt).getComponent(it.type).hide(),t.virtualItem&&t.remove(t.virtualItem),t.dragLine&&t.remove(t.dragLine),t.timer&&clearInterval(t.timer),t.mousedown=!1,document.onmousemove=null,document.onmouseup=null,a&&t.drop(t.task,t.row,c,h,l),tt.allow()}},this.onclick=e=>{e.stop(),e.event.preventDefault(),t.dirty();let i=y.getInstance(t.jcGantt).getComponent(St.type);e.event.ctrlKey?i.ctrlSelect(t):i.selectTask(t)}}drop(t,e,i,s,r){let o=this,a=this.option.onDrag;new Promise(function(h,l){k(a)?a(t,e.data,i?i.task:null,s?s.data:{},r,h):h()}).then(function(){y.getInstance(o.jcGantt).getComponent(q.type).refresh()}).catch(function(h){console.log(h)})}rePosition(t,e,i){let s=y.getInstance(this.jcGantt).getComponent(C.type).coord,r=u(this.task.end).diff(this.task.start,"second");this.task.start=i,this.task.end=u(i).add(r,"second").toDate();let o=s.dateToX(i),a=s.dateToX(this.task.end),h=e.container.getBoundingRect().height-8,l=e.getY()+4;this.x=o,this.y=l,this.width=a-o,this.height=h,this.init(),t.tasks.splice(t.tasks.indexOf(this),1),e.tasks.push(this),this.row=e}mouseMove(t,e,i,s,r){let o=this,a,h,l;if(t.preventDefault(),!t.zrX&&t.zrX!=0||!t.zrY&&t.zrY!=0)return;let c=o.virtualItem,f=o.dragLine,g=y.getInstance(o.jcGantt),v=g.getComponent(q.type),z=g.getComponent(it.type),S=g.getComponent(C.type),Je=S.coord,Tt="",xt;h=Je.xToDate(c.x+c.parent.x),v&&v.option.row&&k(v.option.row.quickTip)&&(a=v.getRowByPos(c.y+c.parent.y),a&&(Tt=v.option.row.quickTip(a.data),l=a.getTaskByDate(h))),xt=h.toLocaleString();let ne="error",R;k(o.option.allowDrag)&&(R=o.option.allowDrag(o.task,o.row.data,l?l.task:null,a?a.data:null,h),R.allow&&(ne="success"),R.messageX&&(xt=R.messageX),R.messageY&&(Tt=R.messageY)),c.dirty(),c.setPosition([c.x+t.offsetX-e,c.y+t.offsetY-i]),f.attr("shape",{x1:s,y1:r,x2:c.x,y2:c.y}),z.show(c.x+c.parent.x,c.y+c.parent.y,xt,Tt,ne),e=t.offsetX,i=t.offsetY;let H=S.isEdge(t.zrX,t.zrY);return H?!o.timer&&(o.timer=setInterval(function(){let V=0;H=="right"?V=S.container.__scroll.moveTo("horizon",2):H=="left"?V=S.container.__scroll.moveTo("horizon",-2):H=="top"?V=S.container.__scroll.moveTo("vertical",-2):H=="bottom"&&(V=S.container.__scroll.moveTo("vertical",2)),o.rePosVirtualRect(H,V)},20)):(clearInterval(o.timer),o.timer=null),{row:a,date:h,x:e,y:i,success:R.allow,task:l}}rePosVirtualRect(t,e){if(!e)return;let i=this.virtualItem,s=this.dragLine;switch(i.dirty(),t){case"left":i.setPosition([i.x+e,i.y]);break;case"right":i.setPosition([i.x+e,i.y]);break;case"top":i.setPosition([i.x,i.y+e]);break;case"bottom":i.setPosition([i.x,i.y+e]);break}s.attr("shape",{x1:s.shape.x1,y1:s.shape.y1,x2:i.x,y2:i.y});let r=y.getInstance(this.jcGantt),o=r.getComponent(q.type),a=r.getComponent(it.type),l=r.getComponent(C.type).coord,c="",f,g,v;o&&o.option.row&&k(o.option.row.quickTip)&&(g=o.getRowByPos(i.y+i.parent.y),g&&(c=o.option.row.quickTip(g.data))),v=l.xToDate(i.x+i.parent.x),f=v.toLocaleString();let z="error",S;k(this.option.allowDrag)&&(S=this.option.allowDrag(this.task,this.row.data,g?g.getTaskByDate(v).task:null,g?g.data:null,v),S.allow&&(z="success"),S.messageX&&(f=S.messageX),S.messageY&&(c=S.messageY)),a.show(i.x+i.parent.x,i.y+i.parent.y,f,c,z)}getTooltip(){return k(this.option.tooltip)?this.option.tooltip(this.task,this.row.data):this.task.text}select(){let t=this;!this.selectRect&&(this.selectRect=new zrender.Rect({shape:{x:-2,y:-2,width:t.rect.shape.width+4,height:t.rect.shape.height+4},style:{stroke:"#000",lineDash:"dashed",fill:"none"}})),this.add(this.selectRect)}unSelect(){this.remove(this.selectRect)}}class je extends G{constructor(t){super(t,t),this.items=[],this.option=t}refresh(){if(!this.taskBuilder)return;let t=this;this.items=[];let e=this.taskBuilder.timeScale.coord,i=this.taskBuilder.table.rows,s=this.taskBuilder.timeScale.model.end,r=u(s),o;i.forEach(a=>{a.data.tasks&&a.data.tasks.forEach(l=>{if(s&&u(l.start).isAfter(r))return;let c=e.dateToX(u(l.start).toDate()),f=e.dateToX(u(l.end).toDate()),g=a.container.getBoundingRect().height-8,v=a.getY()+4;o=new We(this.taskBuilder.jcGantt,t.taskBuilder.timeScale.getTaskContainer(),t.originOption,a,l,c,v,f-c,g),a.tasks.push(o),t.items.push(o)})})}setBuilder(t){this.taskBuilder=t}}class qe{render(t,e){return t.items}}const bt=class Et{constructor(t,e,i,s){this.type=Et.type,this.selections=[];let r=d(d({},Et.defaultOption),s);this.jcGantt=t,this.timeScale=e,this.timeScale.taskBuilder=this,this.table=i,this.table.taskBuilder=this,this.container=e.getTaskContainer(),this.model=new je(r),this.model.setBuilder(this),this.view=new qe,this.aXisPoint=new it(this.container),this.aXisPoint.jcGantt=this.jcGantt,y.getInstance(this.jcGantt).componentRegister(this.aXisPoint.type,this.aXisPoint)}setTheme(t,e){this.model.originOption=m(this.model.option),t&&D(t.task,this.model.originOption,e),this.model.fullOption=this.model.originOption,this.refresh()}refresh(){let t=this;this.selections=[],this.container.removeAll(),this.model.refresh(),this._uiInstance=this.view.render(this.model,null),this._uiInstance.forEach(e=>{t.container.add(e)}),this.aXisPoint.addToContainer(),this.aXisPoint.setEnd(0,this.timeScale.getTimeLineHeight())}setOption(t){}clearSelections(){this.selections.length&&(this.selections.forEach(t=>{t.unSelect()}),this.selections=[])}removeSelection(t){t.unSelect(),this.selections.splice(this.selections.indexOf(t),1)}selectTask(t){t&&(this.clearSelections(),this.addTaskToSelection(t))}ctrlSelect(t){if(this.selections.length==0)return this.selectTask(t);if(this.selections.indexOf(t)>=0){this.removeSelection(t);return}this.addTaskToSelection(t)}getSelections(){return this.selections}addTaskToSelection(t){this.selections.indexOf(t)>=0||(t.select(),this.selections.push(t))}};bt.type="TaskBuilder",bt.defaultOption={textStyle:(n,t)=>({fontSize:12,fontWeight:"bold"}),taskStyle:(n,t)=>({fill:"#5cb3cc80",stroke:"#5cb3cc"})};let St=bt;const ti="",p=class ${static registerTheme(t,e,i){$.themeMap.has(t)&&!i||$.themeMap.set(t,e)}static getTheme(t){return $.themeMap.get(t)}static applyTheme(t,e,i){if(L(e)&&(e=$.getTheme(e)),!e)return;let s=m(e),r=s.timeLine.scales;delete s.timeLine.scales,D(s,t,i),t.timeLine.scales&&t.timeLine.scales.forEach(o=>{D(r,o,i)})}static quickTheme(t,e,i){return{timeLine:{grid:{backgroundColor:"#fff",style:{stroke:t}},scales:{commonStyle:{backgroundColor:t,borderColor:e},style:null},scroll:{trackStyle:{fill:"#acacac80"},thumbStyle:{fill:e}}},task:{taskStyle:(s,r)=>({fill:e,stroke:i,shadowBlur:3,shadowOffsetX:2,shadowOffsetY:1,shadowColor:"#acacac"})},table:{headStyle:{textStyle:{backgroundColor:t,borderColor:e}},row:{commonStyle:{rowStyle:{fill:e,stroke:i}},hoverStyle:{rowStyle:{fill:t+90,stroke:i}},selectStyle:()=>({rowStyle:{fill:t,stroke:i}})},scroll:{trackStyle:{fill:"#acacac80"},thumbStyle:{fill:e}}}}}};p.冰川蜜橙="冰川蜜橙",p.青行未启="青行未启",p.稚艾霓粉="稚艾霓粉",p.西子退红="西子退红",p.秋波虎牙="秋波虎牙",p.冰河时代="冰河时代",p.紫罗兰="紫罗兰",p.橘绿之泉="橘绿之泉",p.橘子糖="橘子糖",p.玫瑰之后="玫瑰之后",p.墨尔本晴="墨尔本晴",p.themeMap=new Map().set(p.冰川蜜橙,p.quickTheme("#84A3BC","#FFBE90","#E2A9A1")).set(p.稚艾霓粉,p.quickTheme("#CF929E","#E3EB98","#c5dc4a")).set(p.青行未启,p.quickTheme("#55bb8a","#9eccab","#84C08E")).set(p.西子退红,p.quickTheme("#87C0CA","#F0CFE3","#efb3e4")).set(p.秋波虎牙,p.quickTheme("#8ABCD1","#E9D1B5","#d7ad7b")).set(p.冰河时代,p.quickTheme("#2971BF","#6EE5E3","#CCE6D9")).set(p.紫罗兰,p.quickTheme("#9A2BD5","#DDCDE8","#5916AF")).set(p.橘绿之泉,p.quickTheme("#63D999","#17bf70","#266c56")).set(p.橘子糖,p.quickTheme("#85C8DF","#FFE6B2","#d7ad7b")).set(p.玫瑰之后,p.quickTheme("#F88C48","#A7CCFF","#E9BDBF")).set(p.墨尔本晴,p.quickTheme("#FF9F27","#6CD1E4","#E8DF88"));let ee=p;const ie=class rt{constructor(t,e,i,s){let r=rt.initMap.get(t);r&&(zrender.dispose(r.zrInstance),rt.initMap.delete(t),window.removeEventListener("resize",r.resize),r=null),y.registerInstance(this),this._init(t,e,i,s),rt.initMap.set(t,this)}setTheme(t,e){L(t)&&(t=ee.getTheme(t)),this.table.setTheme(t,e),this.timeScale.setTheme(t,e)}_init(t,e,i,s){if(!t)throw new Error("The dom is required.(传入的dom不能为空)");let r=e||{};return this.originOption=r,ee.applyTheme(r,i,s),t=this.resolveDom(t),this.dom=t,this.zrInstance=zrender.init(t),this.container=new yt(this.zrInstance.getWidth(),this.zrInstance.getHeight(),"hidden"),this.initTimeScale(r),this.initTable(r),this.initTask(r),this.initMark(r),this.zrInstance.add(this.container),this.initResize(t),this.initApi(),this.onceRendered(),this}resolveDom(t){if(L(t)&&(t=document.getElementById(t)),!t)throw new Error(`The element named '${t}' is not exit.(id为'${t}'的元素不存在)`);return t}initTimeScale(t){this.timeScale=new C(this.zrInstance,t.timeLine),this.timeScale.jcGantt=this,this.timeScale.refresh(),this.container.addContentHorizon(this.timeScale.container),y.getInstance(this).componentRegister(this.timeScale.type,this.timeScale)}initTable(t){t.table&&t.table.show===!1||(this.table=new q(t.table,this.timeScale),this.table.jcGantt=this,this.table&&this.table.setTimeScale(this.timeScale),this.table.refresh(),this.container.addContentHorizon(this.table.container),y.getInstance(this).componentRegister(this.table.type,this.table))}initTask(t){this.taskBuilder=new St(this,this.timeScale,this.table,t.task||{}),y.getInstance(this).componentRegister(St.type,this.taskBuilder),this.taskBuilder.refresh()}initMark(t){t.mark&&(this.mark=new wt(this,t.mark),this.mark.refresh(),y.getInstance(this).componentRegister(wt.type,this.mark))}initResize(t){let e=this;window.addEventListener("resize",i=>{e.resize()})}resize(){let t=this.dom,e=this.zrInstance,i=this.container,s=t.clientWidth,r=t.clientHeight;if(e.resize({width:s,height:r}),i.resize(s,r),A.getInstance().publishedEvent(new J),this.table){let o=this.table.container.getBoundingRect();this.timeScale.container.setPosition([o.width,this.timeScale.container.y])}A.getInstance().publishedEvent(new J)}initListener(){A.getInstance().removeListener(this.container),this.publishDefaultEvent()}publishDefaultEvent(){A.getInstance().publishedEvent(new J)}onceRendered(){if(this.initListener(),this.container.__content.eachChild(t=>{t.setPosition([0,0])}),this.table){let t=this.table.container.getBoundingRect();this.timeScale.container.setPosition([t.width,this.timeScale.container.y])}this.zrInstance.on("click",t=>{O.getInstance().hide()}),this.zrInstance.on("contextmenu",t=>{t.target||O.getInstance().hide()}),this.zrInstance.on("mousedown",t=>{O.getInstance().hide()})}initApi(){this.tableApi=new $e(this.table),this.timeScaleApi=new Ne(this.timeScale),this.taskApi=new Ke(this.taskBuilder)}};ie.initMap=new Map;let Ve=ie;class $e{constructor(t){this.table=t}getSelections(){return this.table.getSelection()}refresh(){this.table.refresh()}updateData(t){this.table.updateData(t)}clearSelections(){this.table.clearSelections()}selectAll(){this.table.selectAll()}exportRowsToJSON(){let t=this.table.getCurrentData(),e=document.createElement("a");e.download="data.json",e.style.display="none";let i=new Blob([JSON.stringify(t,void 0,4)],{type:"text/json"});e.href=URL.createObjectURL(i),document.body.appendChild(e),e.click(),document.body.removeChild(e)}}class Ne{constructor(t){this.timeScale=t}refresh(){this.timeScale.refresh()}setDateRange(t,e){!t||!e||this.timeScale.setDateRange(t,e)}zoom(t){this.timeScale.zoom(t)}dateToX(t){return this.timeScale.coord.dateToX(t)}xToDate(t){return this.timeScale.coord.xToDate(t)}setTimeUnit(t,e){this.timeScale.setTimeUnit(t,e)}}class Ke{constructor(t){this.taskBuilder=t}getSelections(){return this.taskBuilder.getSelections()}refresh(){this.taskBuilder.table.refresh()}}return Ve}();
